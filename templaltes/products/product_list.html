
{% extends 'base.html' %}
{% block content %}
<div class="layout">
  <aside class="sidebar">
    <form method="get">
      <h3>Filters</h3>
      <div style="display:grid; gap:10px;">
        <input type="text" name="q" placeholder="Search" value="{{ request.GET.q }}">
        <select name="category">
          <option value="">All categories</option>
          {% for c in categories %}
            <option value="{{ c.slug }}" {% if request.GET.category == c.slug %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
        <input type="number" step="0.01" name="min_price" placeholder="Min price" value="{{ request.GET.min_price }}">
        <input type="number" step="0.01" name="max_price" placeholder="Max price" value="{{ request.GET.max_price }}">
        <button class="btn btn-primary">Apply</button>
        <a class="btn" href="/">Reset</a>
      </div>
    </form>
  </aside>
  <section class="content">
    <div class="hero">
      <h2>Discover tech essentials</h2>
      <p>Great prices, fast checkout, modern UI.</p>
      <a class="btn btn-primary" href="/">Shop now</a>
    </div>
    <div class="toolbar" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <h2>Products</h2>
      <form method="get">
        <input type="hidden" name="q" value="{{ request.GET.q }}">
        <input type="hidden" name="category" value="{{ request.GET.category }}">
        <input type="hidden" name="min_price" value="{{ request.GET.min_price }}">
        <input type="hidden" name="max_price" value="{{ request.GET.max_price }}">
        <select name="sort" onchange="this.form.submit()">
          <option value="">Sort by</option>
          <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
          <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
          <option value="newest" {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest</option>
        </select>
      </form>
    </div>
    <div class="grid">
      {% for p in page_obj.object_list %}
        <div class="card">
          {% if p.image %}
            <a href="{% url 'product_detail' p.slug %}"><img src="{{ p.image.url }}" alt="{{ p.name }}"></a>
          {% endif %}
          <h3><a href="{% url 'product_detail' p.slug %}">{{ p.name }}</a></h3>
          <div class="badge">{{ p.category.name }}</div>
          <div class="price">${{ p.price }}</div>
          <div>Stock: {{ p.stock }}</div>
          <a class="btn btn-primary" href="/cart/add/{{ p.id }}/">Add to Cart</a>
        </div>
      {% empty %}
        <p>No products found.</p>
      {% endfor %}
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
      <div style="margin-top: 16px; display: flex; gap: 8px; align-items: center;">
        {% if page_obj.has_previous %}
          <a class="btn" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.min_price %}min_price={{ request.GET.min_price }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page={{ page_obj.previous_page_number }}">Prev</a>
        {% endif %}
        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a class="btn" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.min_price %}min_price={{ request.GET.min_price }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
        {% endif %}
      </div>
    {% endif %}
  </section>
</div>
{% endblock %}


